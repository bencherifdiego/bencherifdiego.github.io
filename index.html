<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Streaming viewer</title>
    <link rel='stylesheet' href='https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css'/>
    <link type="text/css" rel="stylesheet" href='https://www.cyberbotics.com/jquery-ui-layout/1.4.4/layout-default.css' />
    <link type="text/css" rel="stylesheet" href='https://www.cyberbotics.com/wwi/R2020a/wwi.css' />
    <link type="text/css" rel="stylesheet" href='style.css' />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <script src='https://code.jquery.com/jquery-3.1.1.min.js' integrity='sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=' crossorigin='anonymous'></script>
    <script src='https://code.jquery.com/ui/1.12.1/jquery-ui.min.js' integrity='sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU=' crossorigin='anonymous'></script>
    <script src='https://www.cyberbotics.com/jquery-ui-layout/1.4.4/jquery.layout.js'></script>
    <script src='https://www.cyberbotics.com/jquery-dialogextend/2.0.4/jquery.dialogextend.min.js'></script>
    <script src='https://cdn.jsdelivr.net/ace/1.2.6/min/ace.js'></script>
    <script src="https://www.cyberbotics.com/wwi/R2020a/webots.min.js"></script>
    <script src="setup-viewer.js"></script>

    <script>
      var ws = new WebSocket("ws://127.0.0.1:1236/");
      ws.onmessage = function (event) {
          var 
              content = document.createTextNode(event.data),
              dt = document.getElementById('dt'),
              temp = document.getElementById('temp');
              test = document.getElementById('test');
              image = document.getElementById('img');
          
          if (content.substringData(0, 2) == '0 ')
          {
              dt.innerHTML = "latitude: ";
              dt.append(content.substringData(2, content.length - 2));
          }
          else if (content.substringData(0, 2) == '1 ')
          {
              temp.innerHTML = "longitude: ";
              temp.append(content.substringData(2, content.length - 2));
          }
          else if (content.substringData(0, 2) == '2 ')
          {
              test.innerHTML = "altitude: ";
              test.append(content.substringData(2, content.length - 2));
          }
          else if (content.substringData(0, 2) == '9 ')
          {
              var decodeTest = decode(content.substringData(2, content.length - 2))
              image.src=""; 
              image.src = "data:image/jpg;base64, " + decodeTest;
          }
      };

      function decode(s)
      {
          const unicodeString = s.replace(
              /[\u00e0-\u00ef][\u0080-\u00bf][\u0080-\u00bf]/g,
              function(c) {
                  var cc = ((c.charCodeAt(0)&0x0f)<<12) | ((c.charCodeAt(1)&0x3f)<<6) | (c.charCodeAt(2)&0x3f);
                  return String.fromCharCode(cc);
              }).replace(
                  /[\u00c0-\u00df][\u0080-\u00bf]/g,
                  function(c) {
                      var cc = (c.charCodeAt(0)&0x1f)<<6 | c.charCodeAt(1)&0x3f;
                      return String.fromCharCode(cc);
                  }
              );
          return unicodeString;
      }
  </script>
  </head>
  <body onload="connect()">
    <div style="padding-left:10px">
      <h1>Webots streaming viewer</h1>
      <p>
        Connect to:
        <input id="IPInput" type="text" value="localhost" />
        :
        <input id="PortInput" type="text" value="1234" />
        <input id="ConnectButton" type="button" value="Connect" onclick="connect()" />
      </p>
    </div>
    <div class="row" style="height: 100%;">
      <div class="col-6">
        <div class="row" style="height: 40%;" id="stream">
          <div id="playerDiv" class="col-12" style="height: 100%;">
          </div>
        </div>
        <div class="row" style="height: 10%;">
          <div class="col-12" style="height: 100%;"></div>
        </div>
        <div class="row" style="height: 40%;">
          <div style="background-color: black; width: 100%;">
          <p id="dt" style="color:greenyellow; margin-left: 30px; margin-top: 20px;">latitude: </p>
          <p id="temp" style="color:greenyellow; margin-left: 30px; margin-top: 10px;">longitude: </p>
          <p id="test" style="color:greenyellow; margin-left: 30px; margin-top: 10px;">altitude: </p>
          </div>
        </div>
      </div>
      <div class="col-6">
        <div class="row" style="height: 40%;" id="cam">
          <div class="col-12" style="height: 100%;">
            <img id="img" src="" style="height: 100%; width: 100%;">
          </div>
        </div>
        <div class="row" style="height: 10%;"></div>
        <div class="row" style="height: 40%;">
        </div>
      </div>
      
    </div>
    
  </body>
</html>
